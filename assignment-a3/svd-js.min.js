// https://github.com/danilosalvati/svd-js
!function(r,f){"object"==typeof exports&&"undefined"!=typeof module?f(exports):"function"==typeof define&&define.amd?define(["exports"],f):f((r=r||self).SVDJS={})}(this,function(r){"use strict";r.SVD=function(r,f,o,t,e){if(f=void 0===f||f,o=void 0===o||o,e=1e-64/(t=t||Math.pow(2,-52)),!r)throw new TypeError("Matrix a is not defined");var i,a,n,s,h,M,l,d,p,u,b,w,q=r[0].length,v=r.length;if(v<q)throw new TypeError("Invalid matrix: m < n");for(var y=[],c=[],x=[],m="f"===f?v:q,S=u=l=0;S<v;S++)c[S]=new Array(m).fill(0);for(S=0;S<q;S++)x[S]=new Array(q).fill(0);var k,A=new Array(q).fill(0);for(S=0;S<v;S++)for(i=0;i<q;i++)c[S][i]=r[S][i];for(S=0;S<q;S++){for(y[S]=l,p=0,n=S+1,i=S;i<v;i++)p+=Math.pow(c[i][S],2);if(p<e)l=0;else for(d=(M=c[S][S])*(l=M<0?Math.sqrt(p):-Math.sqrt(p))-p,c[S][S]=M-l,i=n;i<q;i++){for(p=0,a=S;a<v;a++)p+=c[a][S]*c[a][i];for(M=p/d,a=S;a<v;a++)c[a][i]=c[a][i]+M*c[a][S]}for(A[S]=l,p=0,i=n;i<q;i++)p+=Math.pow(c[S][i],2);if(p<e)l=0;else{for(d=(M=c[S][S+1])*(l=M<0?Math.sqrt(p):-Math.sqrt(p))-p,c[S][S+1]=M-l,i=n;i<q;i++)y[i]=c[S][i]/d;for(i=n;i<v;i++){for(p=0,a=n;a<q;a++)p+=c[i][a]*c[S][a];for(a=n;a<q;a++)c[i][a]=c[i][a]+p*y[a]}}u<(b=Math.abs(A[S])+Math.abs(y[S]))&&(u=b)}if(o)for(S=q-1;0<=S;S--){if(0!==l){for(d=c[S][S+1]*l,i=n;i<q;i++)x[i][S]=c[S][i]/d;for(i=n;i<q;i++){for(p=0,a=n;a<q;a++)p+=c[S][a]*x[a][i];for(a=n;a<q;a++)x[a][i]=x[a][i]+p*x[a][S]}}for(i=n;i<q;i++)x[S][i]=0,x[i][S]=0;x[S][S]=1,l=y[S],n=S}if(f){if("f"===f)for(S=q;S<v;S++){for(i=q;i<v;i++)c[S][i]=0;c[S][S]=1}for(S=q-1;0<=S;S--){for(n=S+1,l=A[S],i=n;i<m;i++)c[S][i]=0;if(0!==l){for(d=c[S][S]*l,i=n;i<m;i++){for(p=0,a=n;a<v;a++)p+=c[a][S]*c[a][i];for(M=p/d,a=S;a<v;a++)c[a][i]=c[a][i]+M*c[a][S]}for(i=S;i<v;i++)c[i][S]=c[i][S]/l}else for(i=S;i<v;i++)c[i][S]=0;c[S][S]=c[S][S]+1}}for(t*=u,a=q-1;0<=a;a--)for(var E=0;E<50;E++){for(k=!1,n=a;0<=n;n--){if(Math.abs(y[n])<=t){k=!0;break}if(Math.abs(A[n-1])<=t)break}if(!k)for(h=0,s=n-(p=1),S=n;S<a+1&&(M=p*y[S],y[S]=h*y[S],!(Math.abs(M)<=t));S++)if(l=A[S],A[S]=Math.sqrt(M*M+l*l),h=l/(d=A[S]),p=-M/d,f)for(i=0;i<v;i++)b=c[i][s],w=c[i][S],c[i][s]=b*h+w*p,c[i][S]=-b*p+w*h;if(w=A[a],n===a){if(w<0&&(A[a]=-w,o))for(i=0;i<q;i++)x[i][a]=-x[i][a];break}for(u=A[n],M=(((b=A[a-1])-w)*(b+w)+((l=y[a-1])-(d=y[a]))*(l+d))/(2*d*b),l=Math.sqrt(M*M+1),M=((u-w)*(u+w)+d*(b/(M<0?M-l:M+l)-d))/u,S=n+(p=h=1);S<a+1;S++){if(l=y[S],b=A[S],d=p*l,l*=h,w=Math.sqrt(M*M+d*d),M=u*(h=M/(y[S-1]=w))+l*(p=d/w),l=-u*p+l*h,d=b*p,b*=h,o)for(i=0;i<q;i++)u=x[i][S-1],w=x[i][S],x[i][S-1]=u*h+w*p,x[i][S]=-u*p+w*h;if(w=Math.sqrt(M*M+d*d),M=(h=M/(A[S-1]=w))*l+(p=d/w)*b,u=-p*l+h*b,f)for(i=0;i<v;i++)b=c[i][S-1],w=c[i][S],c[i][S-1]=b*h+w*p,c[i][S]=-b*p+w*h}y[n]=0,y[a]=M,A[a]=u}for(S=0;S<q;S++)A[S]<t&&(A[S]=0);return{u:c,q:A,v:x}},r.VERSION="1.1.0",Object.defineProperty(r,"__esModule",{value:!0})});
